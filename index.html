<!DOCTYPE html>
<html>
<head>
  <title>Polytopia</title>

</head>

<body>
  <h1>Polytopia transaction generator and signer</h1>
    
<select onchange="viewMethod(this)">
<option value="register">register</option>
<option value="immigrate">immigrate</option>    
<option value="shuffle">shuffle</option>    
<option value="vote">vote</option>    
<option value="verify">verify</option>    
<option value="dispute">dispute</option>    
<option value="reassign">ressign</option>    
<option value="transfer">transfer</option>    
</select>

<div id="method"></div>    
    
<template id="register">
    <button onclick="register()">register</button>
</template>    
<template id="immigrate">
    <button onclick="immigrate()">immigrate</button>
</template>    
<template id="shuffle">
    <button onclick="shuffle()">shuffle</button>
</template>    
<template id="vote">
    <input id="_id" type="number" placeholder="_id"><button onclick="vote()">vote</button>
</template>    
<template id="verify">
    <input id="_account" type="text" placeholder="_account"><button onclick="verify()">verify</button>
</template>    
<template id="dispute">
    <input id="premeetDispute" type="checkbox"><button onclick="dispute()">dispute</button>
</template>    
<template id="reassign">
    <input id="premeetReassign" type="checkbox"><button onclick="reassign()">reassign</button>
</template>    
<template id="transfer">
    <input id="_to" placeholder="_to" type="text"><input id="_amount" placeholder="_amount" type="number"><select id="_token"><option value="0">Personhood</option><option value="1">Registration</option><option value="2">Immigration</option></select><button onclick="transfer()">transfer</button>
</template>    

<template id="transactionGenerator">
    <div>
        <label>Transaction data: </label><input id="calldata" type="text" placeholder="0x1b7e...">
    </div>
    <div>
        <label>Nonce: </label><input id="nonce" type="number" placeholder="0" oninput="inputNonce()">
    </div>
    <div id="gasinput" style="display: none">
    <label>Gas: </label><input id="gas" type="number" placeholder="21000" oninput="inputGas()">
    </div>
    <div id="gaspriceinput" style="display: none">
    <label>Gas price: </label><input id="gasprice" type="number" value="5" oninput="inputGasPrice()">
    </div>
</template>   

<div id="transaction"></div>
    
<script>
    
    var Polytopia = "0x12528bd2392f12d3d18828436814e41f50639dcd"
    
    var transaction = {
            "to": "Polytopia",
            "value": "0x00",
            "gas": "",
            "gasPrice": "",
            "nonce": "",
            "data": ""
        }
    
    function initiate() {
        loadMethod("register")
    }
    initiate()
    
    function resetMethod() {
        document.getElementById('methodLoaded').remove();
    }
    function loadMethod(_method) {
        var div = document.createElement("div");
        div.id = "methodLoaded";
        document.getElementById("method").appendChild(div);
        var method = document.getElementById(_method);
        var clone = method.content.cloneNode(true)
        document.querySelector('#methodLoaded').appendChild(clone);
    }
    function resetTransaction() {
        if(document.getElementById("transactionLoaded")) document.getElementById('transactionLoaded').remove();
    }
    function loadTransaction() {
        var div = document.createElement("div");
        div.id = "transactionLoaded";
        document.getElementById("transaction").appendChild(div);
        var template = document.getElementById('transactionGenerator');
        var clone = template.content.cloneNode(true)
        document.querySelector('#transactionLoaded').appendChild(clone);
    }
    function generateTransaction() {
        resetTransaction()
        loadTransaction()
    }
    function viewMethod(selectObject) {
        resetMethod()
        resetTransaction()
        loadMethod(selectObject.value)
    }
    function transactionData(data, gas) {
        generateTransaction()
        document.getElementById("calldata").value = data
        transaction.data = data
        document.getElementById("calldata").size = data.length
        document.getElementById("gas").value = gas
        transaction.gas = gas
    }
    function inputNonce() {
        transaction.nonce = "0x".concat(Number(document.getElementById("nonce").value).toString(16))
        document.getElementById("gasinput").style.display = "block"
        document.getElementById("gaspriceinput").style.display = "block"
        transaction.gasPrice = 5
    }
    function inputGas() {
        transaction.gas = document.getElementById("gas").value
    }
    function inputGasPrice() {
        transaction.gasPrice = document.getElementById("gasprice").value
    }
    function register() {
        transactionData("0x1aa3a008", 115469)
    }
    function immigrate() {
        transactionData("0x0ca3a075", 21000)
    }
    function shuffle() {
        transactionData("0x2520bf04", 21000)
    }
    function vote() {
        var id = Number(document.getElementById("_id").value)
        var data = "0x0121b93f".concat(id.toString(16).padStart(64, 0))
        transactionData(data, 21000)
    }
    function verify() {
        var account = document.getElementById("_account").value
        var data = "0x63a9c3d7".concat(account.padStart(64, 0))
        transactionData(data, 21000)
    }
    function dispute() {
        viewCalldata(74)
        var premeet = Number(document.getElementById("premeetDispute").checked)
        var data = "0x91ee7bbf".concat(String(premeet).padStart(64, 0))
        transactionData(data, 21000)
    }
    function reassign() {
        var premeet = Number(document.getElementById("premeetReassign").checked)
        var data = "0x62fa2f1f".concat(String(premeet).padStart(64, 0))
        transactionData(data, 21000)
    }
    function transfer() {
        var _to = document.getElementById("_to").value
        var _amount = document.getElementById("_amount").value
        var _token = document.getElementById("_token").value
        var data = "0xdbe58c1f".concat(_to.padStart(64, 0)).concat(_amount.padStart(64, 0)).concat(_token.padStart(64, 0))
        transactionData(data, 51919)
    }
</script>

</body>
</html>
